<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>LogistIQ | HexaHaul</title>
        <link rel="stylesheet" href="/static/admin-new-password.css" />
        <link rel="icon" href="/assets/HexaHaul icon transparent.png" />
    </head>
    <body>

        <!--Admin create new password-->
        <div class="admin-new-password-background">
            <div class="admin-new-password-container">
                <div class="admin-new-password-panel">
                    <div class="admin-new-password-header">
                        <p class="new-password-header">New Password</p>
                        <p class="new-password-text">Create a new strong password for <strong id="email-display"></strong></p>
                    </div>

                    <form class="admin-reset-pass-form">
                        <div class="new-password-container">
                            <div class="input-wrapper">
                                <input type="password" placeholder="New Password" class="admin-new-password" id="admin-new-password" required />
                                <span class="toggle-password" onclick="togglePassword('admin-new-password', 'show-new-password-icon')">
                                    <img src="/assets/visible.png" alt="Show Password" id="show-new-password-icon">
                                </span>
                                <div id="new-password-error" class="error-message">Password does not meet the requirements.</div>
                            </div>
                            <div class="password-requirements">
                                <div class="requirement-item" id="req-length">
                                    <img src="/assets/check.png" class="check-image">
                                    <p class="requirement">Min 8 characters</p>
                                </div>

                                <div class="requirement-item" id="req-symbols">
                                    <img src="/assets/check.png" class="check-image">
                                    <p class="requirement">Symbols</p>
                                </div>

                                <div class="requirement-item" id="req-case">
                                    <img src="/assets/check.png" class="check-image">
                                    <p class="requirement">Lower and uppercase letters</p>
                                </div>
                            </div>

                            <div class="input-wrapper">
                                <input type="password" placeholder="Confirm Password" class="admin-confirm-password" id="admin-confirm-password" required />
                                <span class="toggle-password" onclick="togglePassword('admin-confirm-password', 'show-confirm-password-icon')">
                                    <img src="/assets/visible.png" alt="Show Password" id="show-confirm-password-icon">
                                </span>
                                <div id="confirm-password-error" class="error-message">Passwords do not match.</div>
                            </div>
                        </div>
                        <button type="submit" class="reset-pass-button">Reset Password</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="success-popup" class="popup-overlay" style="display: none;">
            <div class="popup-content">
                <p class="popup-message">Password reset successfully!</p>
                <button id="go-to-login-btn">Back to Login</button>
            </div>
        </div>
        
        <script>
        // Extract email from URL and display it
        const params = new URLSearchParams(window.location.search);
        const email = params.get("email");
        if (email) {
            document.getElementById("email-display").textContent = email;
        }

        function togglePassword(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            if (input.type === "password") {
                input.type = "text";
                icon.src = "/assets/hide.png";
                icon.alt = "Hide Password";
            } else {
                input.type = "password";
                icon.src = "/assets/visible.png";
                icon.alt = "Show Password";
            }
        }

        const passwordInput = document.getElementById("admin-new-password");
        const confirmPasswordInput = document.getElementById("admin-confirm-password");
        const resetButton = document.querySelector(".reset-pass-button");

        function checkRequirements() {
            const value = passwordInput.value;
            const confirmValue = confirmPasswordInput.value;

            const hasLength = value.length >= 8;
            const hasSymbols = /[!@#$%^&*(),.?":{}|<>]/.test(value);
            const hasCase = /[a-z]/.test(value) && /[A-Z]/.test(value);
            const passwordsMatch = value === confirmValue && value.length > 0;

            if (!(hasLength && hasSymbols && hasCase)) {
                passwordInput.classList.add("input-error");
                document.getElementById("new-password-error").classList.add("visible");
            } else {
                passwordInput.classList.remove("input-error");
                document.getElementById("new-password-error").classList.remove("visible");
            }

            if (!passwordsMatch && confirmValue.length > 0) {
                confirmPasswordInput.classList.add("input-error");
                document.getElementById("confirm-password-error").classList.add("visible");
            } else {
                confirmPasswordInput.classList.remove("input-error");
                document.getElementById("confirm-password-error").classList.remove("visible");
            }

            // Show/hide requirements as user types
            document.getElementById("req-length").style.display = hasLength ? "none" : "flex";
            document.getElementById("req-symbols").style.display = hasSymbols ? "none" : "flex";
            document.getElementById("req-case").style.display = hasCase ? "none" : "flex";

            // Enable button only if all requirements are met and passwords match
            resetButton.disabled = !(hasLength && hasSymbols && hasCase && passwordsMatch);
        }

        passwordInput.addEventListener("input", checkRequirements);
        confirmPasswordInput.addEventListener("input", checkRequirements);

        document.querySelector(".admin-reset-pass-form").addEventListener("submit", function(e) {
            let valid = true;

            const value = passwordInput.value;
            const confirmValue = confirmPasswordInput.value;
            const hasLength = value.length >= 8;
            const hasSymbols = /[!@#$%^&*(),.?":{}|<>]/.test(value);
            const hasCase = /[a-z]/.test(value) && /[A-Z]/.test(value);
            const passwordsMatch = value === confirmValue && value.length > 0;

            // New password validation
            if (!(hasLength && hasSymbols && hasCase)) {
                passwordInput.classList.add("input-error");
                document.getElementById("new-password-error").classList.add("visible");
                valid = false;
            } else {
                passwordInput.classList.remove("input-error");
                document.getElementById("new-password-error").classList.remove("visible");
            }

            // Confirm password validation
            if (!passwordsMatch) {
                confirmPasswordInput.classList.add("input-error");
                document.getElementById("confirm-password-error").classList.add("visible");
                valid = false;
            } else {
                confirmPasswordInput.classList.remove("input-error");
                document.getElementById("confirm-password-error").classList.remove("visible");
            }

            e.preventDefault(); // Always prevent default form submission

            if (valid) {
                document.getElementById("success-popup").style.display = "flex";
            }
        });

        // Popup button handler
        document.getElementById("go-to-login-btn").onclick = function() {
            window.location.href = "admin-login.html";
        };
        </script>
    </body>
</html>